<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>The Surgery Experience</title>

  <link rel="stylesheet" href="style.css" />
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <!-- Add Font Awesome for the filter icon -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
  <header>
    <img src="header.png" alt="Surgery Header Image" class="header-image">
    <h1>The Surgery Experience</h1>
  </header>

  <section class="introduction">
    <!-- <h2>Understanding Your Surgery Experience</h2> -->
    <p>Every surgery has a story. From when a patient walks in, to what happens in the OR, to how they recover afterward.</p>
    <p>With data from over 6,000 real surgeries, we break down what happens at each step: prep, the operation itself, and recovery. We show you how different factors like age, gender, and health status affect the experience and what different types of surgeries people undergo.</p>
    <p>Scroll down to explore the full experience and see what the numbers reveal about what really happens during surgery. Use the filters in the bottom right to find cases from patients similar to you.</p>
    <div id="body-container">
      <img src="outline_body.png" id="body-img" />
      <canvas id="overlay"></canvas>
      <div id="heatmap-tooltip"></div>
    </div>
  </section>

  <!-- Collapsible Filter Panel -->
  <div class="filter-panel" id="filterPanel">
    <div class="filter-content">
      <h4>Filters</h4>
      <div id="demo" class="filter-options">
        <label><input type="checkbox" id="toggle-male" unchecked> Male</label>
        <label><input type="checkbox" id="toggle-female" unchecked> Female</label>
        <label>Age: <input type="range" min="0" max="100" id="age" value="25">
          <span class="value-display" id="age-value">25 years</span>
        </label>

        <label>Height: <input type="range" min="50" max="250" id="height" value="170">
          <span class="value-display" id="height-value">170 cm</span>
        </label>

        <label>Weight: <input type="range" min="30" max="200" id="weight" value="70">
          <span class="value-display" id="weight-value">70 kgs</span>
        </label>
      </div>
      <h5>There are <label id = 'case_count'></label> similar cases to yours.</h5>
    </div>
    <button class="filter-toggle" id="filterToggle">
      <i class="fas fa-filter"></i>
    </button>
  </div>

  <!-- Surgery Info Modal -->
  <div id="surgery-modal" class="modal">
    <div class="modal-content">
      <span class="close-button">&times;</span>
      <h3 id="modal-title"></h3>
      <div id="modal-description"></div>
    </div>
  </div>

  <!-- Backdrop for filter panel -->
  <div class="filter-backdrop" id="filterBackdrop"></div>

  <!-- Scrollytelling Section -->
  <div class="scroll-container">
    <div class="sticky-graphic">
      <div id="visualization"></div>
      <div id="surgery-tooltip" class="tooltip"></div>
      <div id="duration-tooltip" class="tooltip"></div>
      <div id="icu-tooltip" class="tooltip"></div>
    </div>

    <div class="scroll-sections">
      <section class="scroll-section" data-step="1">
        <div class="step-content">
          <h3>Pre-Op Assessment</h3>
          <p>Before surgery begins, doctors run lab tests and assess risk. Low hemoglobin or high ASA can signal danger ahead. Preexisting conditions can also be important determiners of what care you should recieve.</p>
        </div>
      </section>

      <section class="scroll-section" data-step="2">
        <div class="step-content">
          <h3>Surgery</h3>
          <p>This is the critical moment. Different surgery types carry different risks and blood loss amounts. As your body undergoes surgery, various compounds change and shift, and lets see how. </p>
          <p><label>Pick a kind of surgery </label>
            <select id = 'surgery-drop'>
              <option value = 'Colorectal'>Colorectal</option>
              <option value = 'Stomach'>Stomach</option>
              <option value = 'Biliary/Pancreas'>Biliary/Pancreas</option>
              <option value = 'Vascular'>Vascular</option>
              <option value = 'Major resection'>Major resection</option>
              <option value = 'Breast'>Breast</option>
              <option value = 'Minor resection'>Minor resection</option>
              <option value = 'Transplantation'>Transplantation</option>
              <option value = 'Hepatic'>Hepatic</option>
              <option value = 'Thyroid'>Thyroid</option>
              <option value = 'Others'>Others</option>
            </select>
            <label> and what you would like to see </label>
            <select id = 'intraop-type'>
              <option value = 'Cell Count'>Cell Count</option>
              <option value = 'Metabolite Levels'>Metabolite Levels</option>
              <option value = 'Electrolyte Levels'>Electrolyte Levels</option>
            </select></p>
        </div>
      </section>

      <section class="scroll-section" data-step="3">
        <div class="step-content">
          <h3>ICU Recovery</h3>
          <p>After surgery, some patients go straight home. Others stay in the ICU for daysâ€”or longer.</p>
        </div>
      </section>

      <section class="scroll-section" data-step="4">
        <div class="step-content">
          <h3>Outcomes</h3>
          <p>Most patients safely recover, although a small minority were unable to.</p>
        </div>
      </section>

      
    </div>
  </div>

  <section class = 'conclusion'>
    <p>Surgery is more than just a single moment; it's a complex process shaped by dozens of unseen variables and many different types that are not commonly talked about.
      By visualizing it step-by-step, we can better understand how these pieces fit together and understand real cases without any extremely complex data or scary visuals.
      </p>
  </section>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/intersection-observer/0.12.0/intersection-observer.min.js"></script>
  <script src="global.js"></script>
  <script type="module">
    import { renderHeatmapFromStaticCounts } from './heatmap.js';
    window.addEventListener('DOMContentLoaded', renderHeatmapFromStaticCounts);
  </script>
  <script>
    // Filter panel functionality
    const filterPanel = document.getElementById('filterPanel');
    const filterToggle = document.getElementById('filterToggle');
    const filterBackdrop = document.getElementById('filterBackdrop');

    function toggleFilterPanel() {
      filterPanel.classList.toggle('open');
      filterBackdrop.classList.toggle('show');
    }

    filterToggle.addEventListener('click', (e) => {
      e.stopPropagation();
      toggleFilterPanel();
    });

    filterBackdrop.addEventListener('click', toggleFilterPanel);

    // Close panel when clicking outside
    document.addEventListener('click', (e) => {
      if (filterPanel.classList.contains('open') && 
          !filterPanel.contains(e.target)) {
        toggleFilterPanel();
      }
    });

    // Prevent panel from closing when clicking inside
    filterPanel.addEventListener('click', (e) => {
      e.stopPropagation();
    });
  </script>
</body>
</html>
